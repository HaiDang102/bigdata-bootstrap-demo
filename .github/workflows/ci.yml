name: BigData-UI-Automation-Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: 1. Kiểm tra mã nguồn (Checkout)
        uses: actions/checkout@v3

      - name: 2. Thiết lập môi trường Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'

      - name: 3. Cài đặt các thư viện (NPM Install)
        run: npm install

      - name: 4. Kiểm tra cài đặt và liên kết Bootstrap (Strict Test)
        run: |
          echo "Bắt đầu kiểm tra hệ thống nghiêm ngặt..."
          
          # KIỂM TRA 1: Xác minh file vật lý tồn tại trong node_modules
          if [ ! -f "node_modules/bootstrap/dist/css/bootstrap.min.css" ]; then
            echo "::error::LỖI HỆ THỐNG: Thư viện Bootstrap chưa được cài đặt đúng!"
            exit 1
          fi
          
          # KIỂM TRA 2: Xác minh file index.html có khai báo Link CSS chính xác
          # Nếu bạn xóa dòng <link> hoặc sai đường dẫn, bước này sẽ báo lỗi
          if ! grep -q "node_modules/bootstrap/dist/css/bootstrap.min.css" index.html; then
            echo "::error::LỖI LOGIC: File index.html đang thiếu liên kết CSS. Giao diện sẽ bị vỡ!"
            exit 1
          fi

          # KIỂM TRA 3: Xác minh file index.html có khai báo Script JS chính xác
          if ! grep -q "node_modules/bootstrap/dist/js/bootstrap.bundle.min.js" index.html; then
            echo "::error::LỖI LOGIC: File index.html đang thiếu liên kết JavaScript. Các thành phần động sẽ không chạy!"
            exit 1
          fi
          
          echo "✅ XÁC NHẬN: Cấu hình môi trường và mã nguồn đồng nhất. Sẵn sàng triển khai!"

      - name: 5. Thông báo hoàn tất
        if: success()
        run: echo "Quy trình CI hoàn tất 100%. Mã nguồn đạt tiêu chuẩn chất lượng."